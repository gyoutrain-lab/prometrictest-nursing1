<script>
const backendURL = "YOUR_DEPLOYED_SCRIPT_URL_HERE";

// Enable button only when fields filled
function checkInputs() {
  const n = document.getElementById("name").value.trim();
  const w = document.getElementById("wa").value.trim();
  document.getElementById("confirmBtn").disabled = !(n && w);
}

document.getElementById("name").addEventListener("input", checkInputs);
document.getElementById("wa").addEventListener("input", checkInputs);

// User submits → generate code + send to admin WA
document.getElementById("confirmBtn").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const wa = document.getElementById("wa").value.trim();

  const res = await fetch(backendURL, {
    method: "POST",
    body: JSON.stringify({
      action: "requestCode",
      name: name,
      wa: wa
    })
  });

  const json = await res.json();

  if (json.error) return alert(json.error);

  const adminMsg = encodeURIComponent(
    `Payment Proof and Confirmation\nName: ${name}\nWA: ${wa}\nGenerated Code: ${json.generatedCode}`
  );

  // open admin WA
  window.open(`https://wa.me/62ADMINNUMBER?text=${adminMsg}`, "_blank");

  alert("Payment confirmation sent to admin. Wait for your unlock code.");
});

// Admin popup enter code → validate
async function unlockPopup() {
  const code = prompt("Enter unlock code from admin:");
  if (!code) return;

  const res = await fetch(backendURL, {
    method: "POST",
    body: JSON.stringify({
      action: "validateCode",
      code: code.trim()
    })
  });

  const json = await res.json();

  if (json.status === "valid") {
    alert("UNLOCK SUCCESS!");
    // show hidden content
    document.getElementById("lockedContent").style.display = "block";
  } else {
    alert("INVALID CODE. Try again.");
    unlockPopup();
  }
}
</script>
